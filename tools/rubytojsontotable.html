<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Ruby Hash → JSON → HTML Tables</title>
<link rel="stylesheet" href="https://david-fear.github.io/stylesheet.css" />
<style>
  textarea { width: 100%; box-sizing: border-box; font-family: monospace; margin-bottom: 10px; font-size: 0.8em;}
  #inputBox { height: 100px; font-family: monospace;  font-size: 0.8em;}
  #outputBox { height: 250px; font-family: monospace;  font-size: 0.8em;}
  #tableBox { height: 10000px; overflow: auto; border: 1px solid #ccc; padding: 1px; font-family: monospace; font-size: 0.8em;}
  button { padding: 10px 20px; font-size: 16px; margin-bottom: 10px; }
  table { border-collapse: collapse; margin: 1px 0; }
  table, th, td { border: 1px solid #999; }
  th, td { padding: 0 3px; text-align: left; vertical-align: top; }
</style>
</head>

<body>
<!-- Dynamic sidebar menu START - right after BODY tag -->
<div id="menu-container"></div>
<script>
  fetch('https://david-fear.github.io/components/menu.html')
    .then(response => response.text())
    .then(data => {
      const container = document.getElementById('menu-container');
      container.innerHTML = data;

      // Now attach event listeners because the elements exist
      const toggle = document.getElementById('menu-toggle');
      const menu = document.getElementById('menu-nav');

      toggle.addEventListener('click', () => {
        const expanded = toggle.getAttribute('aria-expanded') === 'true';
        toggle.setAttribute('aria-expanded', String(!expanded));
        if (menu.hasAttribute('hidden')) {
          menu.removeAttribute('hidden');
        } else {
          menu.setAttribute('hidden', '');
        }
      });

      toggle.addEventListener('keydown', (e) => {
        if (e.key === 'Enter' || e.key === ' ') {
          e.preventDefault();
          toggle.click();
        }
      });
    })
    .catch(e => console.error('Failed to load menu:', e));
</script>
<!-- Dynamic sidebar menu END -->
  
<h2>Ruby Hash → JSON → HTML Tables</h2>

<textarea id="inputBox" placeholder="Paste your Ruby hash here..."></textarea>
<br>
<button onclick="convertRubyHash()">Convert to JSON</button>
<textarea id="outputBox" placeholder="Converted JSON will appear here..."></textarea>
<br>
<button onclick="convertJSONtoTables()">Convert JSON → HTML Tables</button>
<div id="tableBox" placeholder="HTML tables will appear here..."></div>

<script>
// 1️⃣ Convert Ruby Hash → JSON
function convertRubyHash() {
  let rubyStr = document.getElementById('inputBox').value;

  try {
    let jsonStr = rubyStr.replace(/=>/g, ':');       // hash rockets
    jsonStr = jsonStr.replace(/\bnil\b/g, 'null');  // nil → null
    jsonStr = jsonStr.replace(/'((?:\\'|[^'])*)'/g, function(match, p1){
      return `"${p1.replace(/"/g, '\\"')}"`;
    });
    jsonStr = jsonStr.replace(/,(\s*[}\]])/g, '$1'); // trailing commas

    let parsed = JSON.parse(jsonStr);
    document.getElementById('outputBox').value = JSON.stringify(parsed, null, 2);
  } catch (err) {
    document.getElementById('outputBox').value = 'ERROR: Invalid Ruby hash or parsing issue:\n' + err;
  }
}

// 2️⃣ Convert JSON → HTML Tables
function convertJSONtoTables() {
  let jsonText = document.getElementById('outputBox').value;
  if (!jsonText) return alert('No JSON to convert!');

  try {
    let obj = JSON.parse(jsonText);
    let html = jsonToTable(obj);
    document.getElementById('tableBox').innerHTML = html;
  } catch (err) {
    document.getElementById('tableBox').innerHTML = 'ERROR: Invalid JSON:\n' + err;
  }
}

// Recursive function to convert any JSON to HTML table
function jsonToTable(obj) {
  if (Array.isArray(obj)) {
    let rows = obj.map(item => `<tr><td>${jsonToTable(item)}</td></tr>`).join('');
    return `<table>${rows}</table>`;
  } else if (obj !== null && typeof obj === 'object') {
    let rows = '';
    for (let key in obj) {
      rows += `<tr><th>${key}</th><td>${jsonToTable(obj[key])}</td></tr>`;
    }
    return `<table>${rows}</table>`;
  } else {
    // primitive value
    return obj === null ? 'null' : obj.toString();
  }
}
</script>
</body>
</html>

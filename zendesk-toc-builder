<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>TOC Builder - Nested Lists</title>
  <link rel="stylesheet" href="stylesheet.css" />
  <style>
.toc-builder-container {
  display: grid;
  grid-template-columns: 2fr auto 2fr;  /* doubled widths for left and right columns */
  grid-template-rows: 1fr 1fr;
  gap: 20px;
  height: 90vh;
  padding: 20px;
  box-sizing: border-box;
}

#inputBox {
  grid-column: 1 / 2;
  grid-row: 1 / 3; /* full height on left column */
  width: 100%;
  height: 100%;
  font-family: monospace;
  font-size: 10px;
  white-space: pre-wrap;
  overflow: auto;
  resize: none;
  border: 1px solid #ccc;
  border-radius: 6px;
  padding: 10px;
  box-sizing: border-box;
}

#generateBtn {
  grid-column: 2 / 3;
  grid-row: 1 / 3;
  align-self: center;
  justify-self: center;
  height: 50px;
  padding: 10px 20px;
  font-size: 16px;
  cursor: pointer;
  border-radius: 6px;
  background-color: var(--primary);
  color: white;
  border: none;
}
#generateBtn:hover {
  opacity: 0.9;
}

#previewBox {
  grid-column: 3 / 4;
  grid-row: 1 / 2;
  border: 1px solid #ccc;
  background-color: #fafafa;
  padding: 10px;
  font-family: sans-serif;
  font-size: 10px;
  overflow: auto;
  border-radius: 6px;
}

#outputBox {
  grid-column: 3 / 4;  /* moved to right column */
  grid-row: 2 / 3;     /* at bottom */
  border: 1px solid #ccc;
  background-color: #fafafa;
  padding: 10px;
  font-family: monospace;
  font-size: 10px; 
  overflow: auto;
  border-radius: 6px;
  height: 100%;
}
  </style>
</head>
<body>

<!-- Menu will load here -->
<div id="menu-container"></div>

<script>
  fetch('menu.html')
    .then(response => response.text())
    .then(data => {
      const container = document.getElementById('menu-container');
      container.innerHTML = data;

      const toggle = document.getElementById('menu-toggle');
      const menu = document.getElementById('menu-nav');

      toggle.addEventListener('click', () => {
        const expanded = toggle.getAttribute('aria-expanded') === 'true';
        toggle.setAttribute('aria-expanded', String(!expanded));
        if (menu.hasAttribute('hidden')) {
          menu.removeAttribute('hidden');
        } else {
          menu.setAttribute('hidden', '');
        }
      });

      toggle.addEventListener('keydown', (e) => {
        if (e.key === 'Enter' || e.key === ' ') {
          e.preventDefault();
          toggle.click();
        }
      });
    })
    .catch(e => console.error('Failed to load menu:', e));
</script>

<section>
  <p>Switch to the CODE view of a Zendesk Help Center page, copy it and paste 
    the source in the left column. It will demo the TOC (top right) and give
    you the code to inject back into the source HTML (bottom right)</p>
</section>
  
<div class="toc-builder-container">
  <textarea id="inputBox" placeholder="Paste your entire source HTML of your Zendesk Article here..."></textarea>

  <button id="generateBtn">Make&nbsp;TOC&nbsp;&rarr;</button>

  <div id="previewBox" aria-live="polite" aria-atomic="true" role="region">
    <strong>TOC Preview</strong><br /><em>Click the button to generate.</em>
  </div>

  <div id="outputBox" contenteditable="true" spellcheck="false" aria-label="Raw HTML output">
    <!-- Raw HTML TOC output will appear here -->
  </div>
</div>

<script>
  function buildNestedList(headings) {
    const rootUl = document.createElement('ul');
    const stack = [{ level: 0, ul: rootUl }];

    headings.forEach(({ level, id, text }) => {
      while (stack.length > 0 && level <= stack[stack.length - 1].level) {
        stack.pop();
      }

      const li = document.createElement('li');
      const a = document.createElement('a');
      a.href = `#${id}`;
      a.textContent = text;
      li.appendChild(a);

      stack[stack.length - 1].ul.appendChild(li);

      const newUl = document.createElement('ul');
      li.appendChild(newUl);
      stack.push({ level, ul: newUl });
    });

    function cleanEmptyUl(ul) {
      Array.from(ul.children).forEach(li => {
        if (li.lastElementChild && li.lastElementChild.tagName === 'UL') {
          if (li.lastElementChild.children.length === 0) {
            li.removeChild(li.lastElementChild);
          } else {
            cleanEmptyUl(li.lastElementChild);
          }
        }
      });
    }
    cleanEmptyUl(rootUl);

    return rootUl;
  }

  document.getElementById('generateBtn').addEventListener('click', () => {
    const inputHTML = document.getElementById('inputBox').value;
    const parser = new DOMParser();
    const doc = parser.parseFromString(inputHTML, 'text/html');
    const headingNodes = doc.querySelectorAll('h1, h2, h3, h4, h5, h6');

    const headings = [];
    headingNodes.forEach(heading => {
      const level = parseInt(heading.tagName.substring(1), 10);
      const id = heading.getAttribute('id');
      const text = heading.textContent.trim();
      if (id) {
        headings.push({ level, id, text });
      }
    });

    const previewBox = document.getElementById('previewBox');
    const outputBox = document.getElementById('outputBox');

    if (headings.length === 0) {
      previewBox.innerHTML = '<em>No valid headings with IDs found.</em>';
      outputBox.textContent = '';
      return;
    }

    const nestedList = buildNestedList(headings);

    previewBox.innerHTML = '<strong>TOC Preview</strong><br />';
    previewBox.appendChild(nestedList);

    outputBox.textContent = '<div style="border:1px solid #ccc; padding:10px; background:#f9f9f9;">Page Contents:' + nestedList.outerHTML + '</div><br />';
  });
</script>

<!-- Footer placeholder -->
<div id="footer-container"></div>

<script>
  fetch('footer.html')
    .then(response => response.text())
    .then(data => {
      document.getElementById('footer-container').innerHTML = data;
    })
    .catch(error => {
      console.error('Failed to load footer:', error);
    });
</script>

</body>
</html>
